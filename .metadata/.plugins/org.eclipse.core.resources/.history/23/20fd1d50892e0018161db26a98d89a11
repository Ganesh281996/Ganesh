package com.bridgelabz.utility;

import java.util.ArrayList;
import java.util.List;

public interface Subject 
{
	public void register(Observer observer);
	public void unRegister(Observer observer);
	public void notifyObserver();
	public Object getUpdate(Observer observer);
}

interface Observer 
{
	public void update();
	public void setSubject(Subject sub);
}

class MyTopic implements Subject 
{
	private List<Observer> observers;
	private String message;
	private boolean changed;
	private final Object MUTEX= new Object();
	
	public MyTopic()
	{
		this.observers=new ArrayList<>();
	}
	@Override
	public void register(Observer obj) 
	{
		if(obj == null)
		{
			 System.out.println("Null Observer");
		}			
		if(!observers.contains(obj))
		{
			observers.add(obj);
		}
	}

	@Override
	public void unRegister(Observer obj) 
	{
		observers.remove(obj);
	}

	@Override
	public void notifyObserver() 
	{
		List<Observer> observersLocal = null;
		if (changed)
		{
			observersLocal = new ArrayList<Observer>(this.observers);
			this.changed=false;
			for (Observer observer : observersLocal) 
			{
				observer.update();
			}
		}
	}

	@Override
	public Object getUpdate(Observer observer) 
	{
		return this.message;
	}
	
	public void postMessage(String message)
	{
		System.out.println("Message Posted to Topic:"+message);
		this.message=message;
		this.changed=true;
		notifyObserver();
	}
}

class MyTopicSubscriber implements Observer 
{
	
	private String name;
	private Subject topic;
	
	public MyTopicSubscriber(String name)
	{
		this.name=name;
	}
	
	@Override
	public void update() 
	{
		String message = (String) topic.getUpdate(this);
		if(message == null)
		{
			System.out.println(name+":: No new message");
		}
		else
		{
			System.out.println(name+":: Consuming message::"+message);
		}
	}

	@Override
	public void setSubject(Subject subject) 
	{
		this.topic=subject;
	}
}